( [English](release_note_en.md) / **Japanese** )

### 不具合修正

- 補完で、現在の単語が空の場合にカーソルが前の単語の先頭に移動してしまう不具合を修正 (#15,[go-readline-ny v1.12.3 #17](https://github.com/nyaosorg/go-readline-ny/pull/17))
- SQLite3 以外のデータベースで、引数なしのdesc コマンド（テーブル一覧）の中から `Enter` を押下して、該当行のテーブルのカラム一覧を表示できなかった不具合を修正  (#16)
- MySQL で、テーブル一覧表示から、r を押下した時、テーブル名を囲むべき引用符が他のDBと違って `` ` `` だったため、`edit テーブル` コマンドが起動できなかった不具合を修正 (#17)

### 仕様変更

- `SAVEPOINT` を TCL コマンドとしてサポート (#11)
- `SAVE TRANSACTION` を TCL コマンドとしてサポート (#14)
- `ROLLBACK TO`（もしくは `ROLLBACK TRANSACTION`）を TCL コマンドとしてサポート (#11)
- 誤操作防止のため、`ROLLBACK` には `;` を必須とした (#11)
- スクリプト実行時の修正 (#12)
    - `io.EOF` が誤ってエラーとして扱われていた問題を修正した
    - SQL のログ出力で、空行や行頭・行末の空白が出力されないようにした
    - `SELECT` で起動した `CSVI` は、`>`, `q`, `y` の操作で自動的に終了するようにした

### 内部修正

- サブパッケージ `dialect` をリファクタリング: フィールド・メソッドを改名 (#8)
- 端末入力系の API 呼び出しを `go-ttyadapter` v0.2.0 へ切替え (#9)

v0.25.0
=======
Nov 3, 2025

### 不具合修正

- `host`文, `start`文: 最後のトークンが空文字列のときにファイル名補完で panic が発生する問題を修正
  (#4, [go-readline-ny#10], go-readline-ny v1.21.1 にて修正)

[go-readline-ny#10]: https://github.com/nyaosorg/go-readline-ny/pull/10

### 仕様変更

- テーブル名指定なしの `desc` コマンド中に `r` を押下すると、`edit (カーソル行のテーブル名)` を起動するようにした
- テーブル名指定なしの `desc` コマンド中に `Enter` を押下すると、`desc (カーソル行のテーブル名)` を起動するようにした
- 引数なしで `edit` コマンドが起動された時、カーソルでテーブルを選択するモードを起動するようにした。
- Oracle の`MERGE` 文も DML 扱いするようにした。
- `COMMIT` や `ROLLBACK` もセミコロンなしで実行できる1行コマンドとした。
- カラー出力を抑制する環境変数の [`NO_COLOR`](https://no-color.org/) をサポート (#6)

### 内部的な変更

- 依存パッケージを更新 (go-multiline-ny v0.22.1, go-box v3) (#4)
- テーブル名・カラム名補完の際に使用していた `context.TODO()` を `completion.CmdCompletionOrList.CandidatesContext` が提供するコンテキストに変更 (#5)
- Linux 環境や GitHub Actions からテストができるよう、PowerShell 7 で記述していた SQLite3 を使ったテストを、go test に置き変えた (#7)

v0.24.0
=======
Oct 25, 2025

- `edit`文において、行追加・更新時の SQL 上で、空白を含んだテーブル名がおかしい展開をされていた問題を修正
- SQLite3 でプレースホルダーとして `$v%d` 形式のバインド変数を使うようにした
- 対話モードでトランザクションが未完了の状態で `Ctrl-D`、`exit`、`quit` によって終了しようとした場合、`transaction is not closed. Please Commit or Rollback` と表示して終了を防止するようにした。 このチェックはスクリプト実行時には行われない。
- コマンドライン編集中の `Ctrl-C` で SQL-Bless が終了してしまっていたが、現在入力中の SQL の破棄するだけに変更した。
- SQLite3 の `PRAGMA` コマンドでも、`SELECT` や `DESC` と同様にレコードを表示できるようにした。
- OSコマンドを実行する `HOST` に対してシンタックスハイライトを適用。また、`HOST` 以降でファイル名補完が聞くようにした

v0.23.0
=======
Oct 14, 2025

- DML 以外の SQL について、 `"database/sql".DB` の代わりに `"database/sql".Conn` を使用するようにした
    - 前後の SQL で別の接続が使われることで発生しうるトラブルを防ぐため、同一接続を継続使用するように変更
- BEGIN 文をユーザが使用できないようにした
    - トランザクションは内部で自動開始されるため、BEGIN を使うと不整合が起こる可能性がある
- トランザクション中の DDL 実行に関する挙動を改善
    - 従来は一律不可としていたが、データベースごとに実行可能な文を判定するように変更
    - **PostgreSQL**: `VACUUM`, `REINDEX`, `CLUSTER`, `CREATE/DROP DATABASE`, `CREATE/DROP TABLESPACE` 以外はトランザクション内で実行可能
    - **SQLite3**: `VACUUM` 以外はトランザクション内で実行可能
- CSVI を v1.15.0 + snapshot へ更新:
    - カーソル列の幅を広げる `]` と、縮める `[` を実装
    - 白背景の端末でも色が不自然にならないよう、`-rv` オプションを追加
    - 起動時に曖昧幅の Unicode 文字の表示幅を計測していたが、カーソル位置を取得するシーケンス `ESC[6n` をサポートしない端末では、入力待ちのままエラー終了してしまう問題があった。そのため：
        - `ESC[6n` が無効な場合でもエラーとせず、編集を継続できるようにした。
        - 環境変数 `RUNEWIDTH_EASTASIAN` が定義されていたら、曖昧幅の Unicode 文字の幅計測を省くようにした。
    - 環境変数 `NO_COLOR` が定義されている場合、カラー表示を抑制するようにした ( https://no-color.org/ に準拠 )
    - 環境変数 `COLORFGBG` が `(FG);(BG)` 形式で定義されており、(FG) が (BG) より小さい整数の時、白背景を想定した色使いをするようにした (`-rv`と等価)

v0.22.0
=======
Oct 5, 2025

- `edit` コマンド
    - 終了操作を `ESC` キーに一本化した
        - `ESC` + `y`: 変更を適用して終了
        - `ESC` + `n`: 変更を破棄して終了
        - `c`: まだ利用可能だが、廃止予定
        - `q`: `ESC` と等価
    - テーブル名表示を囲む括弧の種類を 【】から [] に変更
    - 変更適用時の選択肢に、全てを適用する `a` 、全て破棄する `N` を追加した
    - 確認用の SQL が行数をとりすぎるので、SET句、WHERE句、引数リストはそれぞれ一行におさめるようにした
- CRLF モードの実装で、golang.org/x/text/transform を使用しないようにした

v0.21.0
=======
Sep 27, 2025

- `edit` コマンド
    - 値の指定にプレースホルダーを利用するよう変更
    - SQLite3 の日時列更新において、列の型に応じて以下の関数で正規化して比較するよう変更
        - `DATETIME` / `TIMESTAMP` 列 → `datetime()`
        - `DATE` 列 → `date()`
        - `TIME` 列 → `time()`
      この結果、ISO8601 文字列に `T` や `Z` が含まれていても、含まれていなくても更新できるよう改善
    - 他のコマンドと同様、更新件数が 0 件の場合はトランザクションを開始せず、プロンプトを `SQL>` のまま維持するように変更
    - `edit` コマンドで、編集前の SELECT 結果を spool 先に出力していた動作を廃止  
      ( `select` コマンドについては、従来どおり spool 先にも出力する動作を維持 )
- コマンドライン入力で Enter のみを押下した場合、従来は末尾にセミコロンがなければ入力継続とみなしていたが、入力行が以下のコマンド名で始まる場合は、セミコロンがなくても即時に実行するように変更した。
    - `DESC`, `EDIT`, `EXIT`, `HISTORY`, `HOST`, `QUIT`, `REM`, `SPOOL`, `START`, `\D`
- 起動時からスプール可能にする `-spool FILENAME` オプションを追加。
- OSコマンドを実行する `host` コマンドを追加。

v0.20.0
=======
Sep 14, 2025

- 不具合修正
    - EDIT コマンドで、SQLite3 データベースで日付カラムを含むテーブルに対する更新が失敗していた
    - SQL Server で共有メモリ接続ができなかった問題を修正
        - 必要なサブパッケージ `"github.com/microsoft/go-mssqldb/sharedmemory"` が import されていなかった
        - 共有メモリ接続を行う場合は、接続文字列にパラメータ `protocol=lpc` を指定する必要があります  
          例: `Server=localhost\SQLEXPRESS01;Database=master;Trusted_Connection=True;protocol=lpc;`  
          参考: https://github.com/microsoft/go-mssqldb/issues/96
    - テーブル名なしの `DESC`, `\D` コマンドで、タイトルが空になっていた
- アプリ仕様変更
    - NULL を`<NULL>` と表現していたのを Unicode U+2400 (&#x2400;, SYMBOL FOR NULL) を用いるようにした
    - EDIT コマンドで非文字列系セルを0文字にした時、NULL とするようにした。
    - 最初の DML が更新行ゼロだった場合は、トランザクションを開始せずプロンプトを SQL> のままにした。
    - テーブル名なしの `DESC`, `\D` コマンドや、テーブル名補完では、ユーザーテーブル以外のオブジェクトは出さないようにした
- ライブラリ仕様変更
    - 全体をリファクタリングし、メインパッケージ `"sqlbless"` からサブパッケージ `"dialect"`, `"rowstocsv"`,`"spread"` にコードを分離した
    - DB ごとのカスタマイズパッケージのパスを `"dialect"` の下へ移動

v0.19.0
=======
Sep 6, 2025

- START コマンドでは、パラメータをファイル名として補完するようにした。
- EDIT, DESC, \D コマンドでもテーブル名を補完するようにした。
- SKK かな漢字変換ライブラリ: go-readline-skk を v0.6.0 へ更新:
    - 変換結果にスラッシュを含む単語も変換・単語登録できるようにした
    - emacslisp で書かれた変換結果について `(concat)`, `(pwd)`, `(substring)`, `(skk-current-date)` 程度は評価できるようにした (`(lambda)` はまだ)
- スプレッドライブラリ csvi をv1.14.0 へ更新：
    - 現在カーソルがあるセルの内容で検索するコマンド `*`, `#` を追加

v0.18.0
=======
Jun 25, 2025

- go-readline-ny をv1.9.1 へ更新
- go-multiline-ny を v0.21.0 へ更新
    - コメントにも色(黄色)をつけるようにした
    - `"go-multiline-ny/completion".CmdCompletionOrList` を使うようにした
- テーブル名・カラム名補完をサポート（ただし、カラム名補完はテーブル名がカーソルより左側に登場している時のみ）
- STARTコマンドの中で、スクリプトの内容を重複して読んでしまう不具合を修正した
- Go 1.20.14 でビルドし、Windows 7,8, Server2008以降で稼動できるようにした。

v0.17.0
=======
Jan 20, 2025

- go-multiline-ny を v0.18.4 , go-readline-ny を v1.7.1 へ更新
    - プリフィックスキー(Esc) が押下された時に、`Esc-` とecho するようにした
    - Esc → Enter キーに入力確定を割り当てた
- エラーが発生したとき、トランザクションを始めないようにした。
- 入力されたSQL中の予約語にはシアン、文字列にはマゼンダなどの色をつけるようにした。

v0.16.0
=======
Nov 21, 2024

- トランザクション中はプロンプトを `SQL>` ではなく `SQL*` とするようにした
- コピペの邪魔にならないよう、入力後、継続プロンプトを削除するようにした
- edit文: ヘッダに SQL と説明を表示するようにした
- go-readline-ny を v1.6.2 へ更新
    - 履歴を元にした行単位の予想入力のサポート
    - Linux デスクトップのターミナルで、複数行を貼り付けた時、二行目以降が欠ける不具合を修正
- go-multiline-ny を v0.17.0 へ更新
    - インクリメンタルサーチ実装 (Ctrl-R)
    - Windows の旧ターミナルで、カーソルが上に移動しない問題を修正
    - Linux デスクトップのターミナルで、Backspace キーで改行を削除できない不具合を修正(Ctrl-H は可能)
    - 画面行数を越える長い行の編集時、スクロール行数がおかしくなる不具合を修正

v0.15.2
=======
Sep 21, 2024

- [#3] v0.15.0 以降で y/n の問合せで panic が発生する不具合を修正

[#3]: https://github.com/hymkor/sqlbless/issues/3

v0.15.1
=======
Sep 19, 2024

- 空入力だけで panic が起きてしまう不具合を修正
- ライブラリとして利用できるよう、main パッケージを cmd/sqlbless に分離した

v0.15.0
=======
Jul 28, 2024

- modernc.org/sqlite v1.31.0 での windows/386 対応にともない、SQLite3 ドライバーをgithub.com/glebarez/go-sqlite に一本化。全てのアーキテクチャでPureGo化

v0.14.0
=======
Jun 10, 2024

- セルの入力チェックに失敗した時、失敗した入力値を破棄せず、修正を促すようにした
- FLOAT, DOUBLE, REAL, SERIAL, YEAR という語句を含む型も数値扱いするようにした
- ヒストリ参照前の変更テキストが保存されるのが最新エントリだけだったのを、全エントリに対して、今の入力が確定されるまで保存するようにした
- コマンド第二引数のデータソース名がドライバー名を接頭語として含んでいれば、第一引数のドライバー名は省略できるようにした
- コマンド引数のデータソース名に空白が含まれていても引用符で囲まなくてもよくした
- `-debug` オプション指定時、`desc` コマンドが発行している SQL を表示するようにした
- `-term string` オプション: セミコロンのかわりに使うSQL の終了文字を指定
  (`-term "/"` で、Oracle の PL/SQL が実行可能になった)
- MySQL では `?parseTime=true&loc=Local` をデフォルトとした
- `edit`: カラム名に空白が含まれているとき、カラム名を二重引用符で囲むようにして、SQLをエラーにしないようにした

### 不具合修正

- `-debug` 指定時、`d` もしくは `x` でデバッグ用ヘッダー行がクリアできる問題を修正
- `-debug` オプション指定時、ColumnType.ScanType() が nil を返すカラムがあると、`edit` コマンドが panic する不具合を修正

v0.13.0
=======
Jun 4, 2024

- テーブルが一つもない時の `desc` コマンドのメッセージを修正  
  `: table not found` → `no tables are found`
- スプールファイルの日時フォーマットを変更  
  `# (2024-05-30 18:15:52)` → `### <2024-05-30 18:46:13> ###`
- `Spooling to '%s'` というメッセージの前に空行を追加
- `edit` & `select`: `-print-type` に かわって `-debug` を実装。SELECT/EDIT時にヘッダに型情報を載せる
- タイムゾーンを格納できる型では、日時のリテラルにタイムゾーンを含めるようにした
- 小数秒、OracleのTIMESTAMP型、SQL ServerのSMALLDATETIME型,DATETIMEOFFSET などをサポート

### edit コマンドの修正

- 発行されるSQLもスプールファイルに記録するようにした
- 実行するSQLを表示する前に `\n---\n` で区切るようにした
- 実行の確認で、`y` と `n` 以外のキーは無視するようにした(要再入力)
- SQLがエラーになった時、残りの SQL の実行を継続するか(`c`)、中断するか(`a`)確認するようにした
- エディターでのセル入力時に必要最小限の入力チェックを行うようにした
- `x` や `d` で NULL をセットできるようにした
- １行も存在しない時に `data not found` となって起動できなかった問題を修正

### csvi v1.10.0 での修正

- `o` や `O` で入力されたテキストが記入される列がカーソルのあった列ではなく常に先頭列になっていた不具合を修正
- `O` でテキストを入力する時の反転セルの行位置がずれている不具合を修正
- ヘッダー部を変更できないようにした
- 末尾のデータがない行を作らないようにした

v0.12.0
=======
May 29, 2024

- [#1] SQLite3 をサポート。windows-386向けには "mattn/go-sqlite3" を、他の組合せには "glebarez/go-sqlite" を使うようにした。(Thanks to [@emisjerry] and [@spiegel-im-spiegel])
- サポートしていないドライバー名が与えられた時、エラーにならない問題を修正
- ( テストスクリプトが最新仕様に対応していなかった点を修正し、./test へ移動 )

[#1]: https://github.com/hymkor/sqlbless/issues/1
[@emisjerry]: https://github.com/emisjerry
[@spiegel-im-spiegel]: https://github.com/spiegel-im-spiegel

v0.11.0
=======
May 27, 2024

- テーブルデータを CSVI で編集するコマンド: `edit テーブル名 [where ...]` を用意
- START コマンドがエラーメッセージを返さない不具合を修正
- START コマンド用のスクリプトの内容はヒストリに含めないようにした
- `-tsv` オプションを使用すると SELECT の列がすべて連結されてしまう不具合を修正
- (go-multiline-ny) Ctrl-P/N を入力する前のテキストを、ヒストリの最新エントリ扱いにして、失なわれないようにした

v0.10.1
=======
May 9, 2024

- SQL がエラーの時でも CSV ページャが呼ばれる問題を修正
- エスケープシーケンスがスプールファイルに含まれてしまう問題を修正
- `desc TABLE` で TABLE が存在しない時もページャが呼ばれる問題を修正
- Ctrl-D もしくは `exit` で終了した時、EOF がエラーとして表示される問題を修正

v0.10.0
=======
May 8, 2024

- テストやベンチマークのため `-auto` オプションを実装
- [ExpectLua] スクリプトで書かれたテストコードを PowerShell へ置き換えた
- SELECT文の出力のため、[CSVI] をページャーとして使用するようにした

[ExpectLua]: https://github.com/hymkor/expect
[CSVI]: https://github.com/hymkor/csvi

v0.9.0
=======
Sep 4, 2023

- 入力行が `;` で終わっていた場合、Enter キーを入力終結として機能するようにした。

v0.8.0
=======
May 15, 2023

- TABキーで、SELECT や INPUT といったキーワードの入力補完ができるようになった。

v0.7.1
=======
May 4, 2023

- インポートしているライブラリを更新
    - go-readline-ny  from v0.10.1 to v0.11.2
    - go-multiline-ny from v0.6.7  to v0.7.0
        - 行頭にカーソルがあるとき、← や Ctrl-B でも前の行末にカーソルを移動できるようにした。
        - 行末にカーソルがあるとき、→ や Ctrl-F でも次の行頭にカーソルを移動できるようにした。

v0.7.0
=======
Apr 25, 2023

- オプション: `-f -` で標準入力よりスクリプトを読むようにした
- 標準入力が端末ではない時、 go-readline-ny を使わず、標準入力をシーケンシャルに読むようにした
- MySQL をサポート
- （デバッグオプションとして、SELECT結果の各列の型を表示する `-print-type` を追加）

v0.6.0
=======
Apr 22, 2023

- （複数行対応していないので）インクリメンタルサーチの Ctrl-S と Ctrl-R を無効化
- オプション -submit-enter を追加（Enter と Ctrl-Enter を入れ替える）
- PostgrelSQL のコマンド psql もやっていないようなので、エラー時の自動ロールバックを廃止
- ファイルの SQL を実行するコマンド `START filename` とオプション `-f filename` を実装（SQLの終端子は `;` になります）
- コメント用の `REM` 文を追加
- `spool` 文：SQL の末尾に `;` を追加するようにした
- DDL文が成功したときは `Ok` を表示するようにした

v0.5.0
=======
Apr 19, 2023

- `spool` でプログラムのバージョンも記録するようにした
- Microsoft SQL Server もサポート
- 最初の SQL が入力されるまでログインエラーが起きない問題を修正

v0.4.0
=======
Apr 17, 2023

- 起動時にバージョン、ビルド時の GOOS,GOARCH,Goのバージョンを表示するようにした
- オプション追加
    - `-null "string"` : NULL を表現する文字列を設定
    - `-fs "string"` : カンマの代わりの区切り文字を指定
    - `-crlf` : 改行に CRLF を使う
    - `-tsv` : 区切り文字として TAB を使う

v0.3.0
=======
Apr 16, 2023

- select: フィールドが utf8 として妥当な `[]byte` の時、文字列として表示するようにした
- `desc` と `\d`: 引数なしでテーブル一覧表示、引数指定のテーブル仕様表示を実装
- エディター改良: 二重引用符で囲まれたテキストをマゼンタで表示
- spool コマンド改良
    - 引数なしがない場合、スプールを終了するのではなく、現在の状況を表示するようにした
    - コマンドごとにタイムスタンプをスプールファイルに出力するようにした
    - プロンプトにスプール中のファイル名を表示
    - アペンドモードでオープンし、既存のファイルを空にしないようにした

v0.2.0
=======
Apr 15, 2023

- スプールされた SQL の各行の先頭に `#` を挿入 ( `grep -v "^#" FILENAME` で、CSVデータのみが取り出せる）
- [go-readline-ny v0.10](https://github.com/nyaosorg/go-readline-ny/releases/tag/v0.10.1) のための修正（色付けinterfaceの戻り値が int から `readline.ColorSequence` 型にかえる対応）
- Oracle以外ではデフォルトでエラー時に自動でロールバックするようにした（前は PosgreSQL の時はロールバックするようにしていた。要は今後サポート DB が増えたときにどちらがデフォルトにするかという話）
- エラー時、メッセージに `(%T)` （エラーの型）を含むようにした
- `exit` , `quit` , EOF で終了する際、トランザクションを自動的にロールバックするようにした。

v0.1.0
=======
Apr 10, 2023

初版
